{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://learngraphics.local/schemas/lesson-package.schema.json",
  "title": "LessonPackage",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "request_id",
    "course_plan",
    "lesson_script",
    "exercise_set",
    "assessment_rubric",
    "dsl_patch",
    "quality_report"
  ],
  "properties": {
    "request_id": {
      "type": "string"
    },
    "course_plan": {
      "type": "object"
    },
    "lesson_script": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "sections"
      ],
      "properties": {
        "sections": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "segment_id",
              "title",
              "narration",
              "steps",
              "check_questions"
            ],
            "properties": {
              "segment_id": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "narration": {
                "type": "string",
                "minLength": 10
              },
              "steps": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string"
                }
              },
              "check_questions": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "exercise_set": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "items"
      ],
      "properties": {
        "items": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "exercise_id",
              "title",
              "input",
              "steps",
              "expected_output",
              "difficulty"
            ],
            "properties": {
              "exercise_id": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "input": {
                "type": "string"
              },
              "steps": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string"
                }
              },
              "expected_output": {
                "type": "string"
              },
              "difficulty": {
                "type": "string",
                "enum": [
                  "easy",
                  "medium",
                  "hard"
                ]
              }
            }
          }
        }
      }
    },
    "assessment_rubric": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "dimensions"
      ],
      "properties": {
        "dimensions": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "id",
              "name",
              "scale_min",
              "scale_max",
              "criteria"
            ],
            "properties": {
              "id": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "scale_min": {
                "type": "integer",
                "const": 1
              },
              "scale_max": {
                "type": "integer",
                "const": 5
              },
              "criteria": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "1",
                  "2",
                  "3",
                  "4",
                  "5"
                ],
                "properties": {
                  "1": {
                    "type": "string"
                  },
                  "2": {
                    "type": "string"
                  },
                  "3": {
                    "type": "string"
                  },
                  "4": {
                    "type": "string"
                  },
                  "5": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "dsl_patch": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "op",
          "path"
        ],
        "properties": {
          "op": {
            "type": "string",
            "enum": [
              "add",
              "remove",
              "replace",
              "move"
            ]
          },
          "path": {
            "type": "string"
          },
          "from": {
            "type": "string"
          },
          "value": {}
        }
      }
    },
    "quality_report": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "hard_rule_pass",
        "rubric_score",
        "violations"
      ],
      "properties": {
        "hard_rule_pass": {
          "type": "boolean"
        },
        "rubric_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 5
        },
        "violations": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "code",
              "message",
              "severity"
            ],
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "severity": {
                "type": "string",
                "enum": [
                  "low",
                  "medium",
                  "high"
                ]
              },
              "segment_id": {
                "type": "string"
              },
              "suggestion": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  }
}
