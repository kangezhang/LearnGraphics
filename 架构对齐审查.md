# 架构对齐审查（2026-02-26 / 2026-02-27）

## 范围
- 对照文档：`架构设计方案.md`、`开发路线图.md`
- 代码范围：`src/` 全链路（DSL -> Semantic -> Timeline -> Views/Gizmos）
- 审查目标：确认实现是否对齐架构约束，并识别潜在问题

## 问题清单

| ID | 严重级别 | 结论 | 状态 |
|---|---|---|---|
| R1 | 高 | DSL 未知实体类型会被静默降级为 `node`，掩盖语义错误 | 已修复（2026-02-26） |
| R2 | 高 | 锚点表达式存在静默回退到 `center` 的路径，错误不可见 | 已修复（2026-02-26） |
| R3 | 高 | Timeline tick 未驱动主视图（3D/Graph/Inspector）状态更新，只有特例逻辑在 `main.ts` | 已修复（2026-02-26） |
| R4 | 高 | `TimelineRuntime.applySerialized()` 未恢复 `duration/loop` | 已修复（2026-02-26） |
| R5 | 中 | `arrow` 位置字段存在 `x/y/z` 与 `ox/oy/oz` 不一致 | 已修复（2026-02-26） |
| R6 | 中 | `LabelGizmo` 选中态重绘文本来源错误，可能丢失 label | 已修复（2026-02-26） |
| R7 | 中 | `ProjectionHelperGizmo.update()` 重建角标对象但未回接对象列表 | 已修复（2026-02-26） |
| R8 | 中 | `View3D.resize()` 为空实现，面板 resize 时渲染尺寸不同步 | 已修复（2026-02-26） |
| R9 | 中 | `InspectorView` 通过 `innerHTML` 渲染属性值，存在注入风险 | 已修复（2026-02-26） |
| R10 | 低 | Binding 产物未接入运行链路（编译有产出，执行未消费） | 已修复（2026-02-26） |

## 新增对齐目标（2026-02-27）

| ID | 严重级别 | 对齐目标 | 状态 |
|---|---|---|---|
| H1 | 高 | 语义层新增 `line/plane/model`，禁止未知类型静默通过 | 已完成（2026-02-27） |
| H2 | 高 | 渲染层补齐对应 Gizmo，确保 `updateFromSemantic()` 与释放逻辑完整 | 已完成（2026-02-27） |
| H3 | 中 | 参数化链路覆盖 `line/plane/model`（slider + expr + timeline） | 已完成（2026-02-27） |
| H4 | 中 | 补充 DSL 示例与课程文档，验证“仅 DSL 可搭建场景” | 已完成（2026-02-27） |
| H5 | 中 | Lesson Controls 与 Timeline 帧对齐（当前帧写 keyframe + playhead 回显） | 已完成（2026-02-27） |

## 修复顺序
1. R1 -> R2 -> R3 -> R4（高优先）
2. R5 -> R6 -> R7 -> R8 -> R9（中优先）
3. R10（Binding 运行链路接入，已完成）

## 备注
- 修复过程中同步更新本审查文档状态。
- 每次代码修复完成后，同步更新主文档状态（`开发路线图.md`/`架构设计方案.md`/`README.md`）。
