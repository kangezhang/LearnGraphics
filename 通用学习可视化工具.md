# 通用可视化工具

下面给你一份**可直接开工的完整项目方案（通用可视化平台版）**：你可以把它当作 PRD + 技术方案 + 里程碑拆解 + 工程规范。一切围绕一个目标——**让人/AI 用“意图描述”创建可视化课程**，而不是写 Three.js/坐标/算法细节。

* * *

1\. 项目定位
========

1.1 产品定位
--------

一个基于 Web（Three.js 为 3D 视图引擎）的**通用“知识过程可视化平台”**，支持：

*   图形学/数学/物理/算法/ML/系统架构等领域
*   多视图联动（3D、Graph、Inspector/Plot）
*   过程演示（step、状态机、连续动画）
*   **编辑器式轨道时间轴**编排讲解节奏（keyframe/event/step/state、markers、clips）
*   Lesson 采用**声明式 DSL**，可由 AI 自动生成/修改（patch）

1.2 成功标准（验收用）
-------------

1.  新增 lesson：**只写 DSL 文件**即可运行（无需 Three.js、无需坐标）。
2.  时间线编辑器可拖拽关键帧/marker，立刻改变演示节奏，并能保存回 DSL。
3.  至少 5 个跨领域示例课：几何（点积投影）+ 图算法（BFS）+ 数值（梯度下降）+ 系统（DAG 调度）+ 图形学（Ray 相交）。
4.  DSL 错误不崩溃：出现**语义级错误提示**（面向 AI/作者）。

* * *

2\. 总体架构（必须按这三层做）
=================

2.1 三层 + 编辑器
------------

*   **Layer 1 Execution（运行层）**  
    Three.js 渲染/输入/拾取/资源/渲染循环 + Gizmo/Overlay 渲染
*   **Layer 2 Semantic Runtime（语义层）**  
    Entities / Relations / Fields / Process / Views / Timeline 的语义模型与绑定
*   **Layer 3 Authoring（创作层）**  
    Lesson DSL（JSON/YAML）+ Patch（AI 增量修改）
*   **Timeline Editor（轨道时间轴编辑器）**  
    轨道 UI + Keyframe/Marker/Clip 编辑 + 保存回 DSL

2.2 数据流（你要写的“编译器”）
------------------

DSL → parse → Semantic Graph → validate → resolve anchors → build bindings → runtime (views + timeline + process)

* * *

3\. 技术栈与工程基建
============

3.1 推荐技术栈
---------

*   **Vite + TypeScript**
*   渲染：Three.js（3D View）
*   2D Graph View：先用 Canvas/SVG 自写最小版（后期再抽象/替换）
*   UI：建议先轻量（原生 DOM 或极薄组件层），避免 React/Vue 绑架节奏
*   文档：Markdown（每个 lesson 一份 doc.md）
*   状态：轻量 store（自己写或小库；关键是可序列化）

3.2 代码结构（落地）
------------

```
src/
  app/                  # UI Shell + 路由 + 面板 + Timeline Editor
  core/                 # Execution
    renderer/ camera/ input/ picking/ assets/
    gizmos/ overlays/ debug/
  semantic/              # Semantic runtime
    model/ anchors/ processes/ bindings/ validator/ compiler/
  timeline/
    runtime/ tracks/ editor/
  dsl/
    schema/ examples/ patch/
  lessons/               # DSL + doc（内容仓库）
```

* * *

4\. “积木系统”设计（平台的核心资产）
=====================

> 积木不是“效果”，而是**表达能力**：对象/关系/过程/场/视图。

4.1 积木分层
--------

### A. 通用实体积木（跨学科）

*   Node / Edge / Group
*   Point / Line / Arrow
*   Label / Marker / Badge（数值小标签）
*   Handle（可拖控件）

### B. 通用关系积木（理解发生的地方）

*   MeasureDistance / MeasureAngle
*   ProjectionHelper（投影线/垂足）
*   IntersectionMarker（交点）
*   ConstraintEdge（依赖/约束线）

### C. 通用过程积木（“算法感”来源）

*   StepSequence（步骤点串/编号）
*   StateOverlay（状态：running/hit/fail/settled）
*   TraceTrail（轨迹：路径/参数更新）
*   CompareA/B（对比模式，后置）

### D. 场与曲面（跨领域高级能力）

*   ScalarField / VectorField（语义抽象）
*   SampleProbe（鼠标采样）
*   IsoLine（2D 等值线）→ 优先做
*   IsoSurface（3D 等值面）→ 后置

4.2 Gizmo/Overlay 统一接口（强制）
--------------------------

每个可视化部件都必须具备：

*   `attach(ctx)` / `update(dt)` / `dispose()`
*   可开关、可高亮、可设置 label
*   只通过语义属性更新，不暴露 three 底层到 lesson

* * *

5\. 多视图系统（让“通用”成立）
==================

至少三类 View，且支持联动 Selection：

1.  **3D View（Three.js）**：几何、相机、射线、场的 3D 表达
2.  **Graph View（2D）**：算法、依赖、DAG、状态图
3.  **Inspector/Plot View（2D 面板）**：表格、队列、loss 曲线、日志（Plot 后置也行）

联动能力（平台级）：

*   selection：选中实体 → 所有视图高亮、右侧属性显示
*   focus：点击某视图的对象 → 语义实体 id 统一

* * *

6\. 时间线系统（编辑器式轨道时间轴）
====================

> 时间线是平台第二核心资产：用于“讲解节奏”和“过程演示”。

6.1 Timeline Runtime（运行时）
-------------------------

提供：

*   play/pause/seek/speed/loop
*   mode：continuous / stepped
*   deterministic：同 DSL 同 seed 结果一致
*   replay：支持重算/快照（过程类）

6.2 轨道类型（第一期就做这 4 种）
--------------------

1.  **PropertyTrack**：数值/向量属性 keyframes（插值）
2.  **EventTrack**：时间点触发动作（切视图/高亮/弹注释）
3.  **StepTrack**：离散 step index（前进/后退/跳转）
4.  **StateTrack**：状态机（hit/miss/fail… 触发事件）

6.3 Markers 与 Clips（强烈建议第一期也做）
------------------------------

*   **Marker**：讲解点（文字 + 可关联实体 + 可关联视图）
*   **Clip**：片段（“这一段讲什么”）——支持把一段过程封装、复用、重排

6.4 Timeline Editor（UI 必备能力）
----------------------------

*   Track list + ruler（时间标尺）
*   keyframe 拖拽、数值编辑
*   marker 拖拽、编辑文本
*   step 控制（上一/下一/跳转）
*   保存：写回 DSL.timeline 或写 patch

* * *

7\. Lesson DSL v0（让 AI/用户不写代码）
==============================

7.1 DSL 的基本原则（硬约束）
------------------

*   **禁止写 world position**  
    只能使用语义锚点：`camera`、`center`、`intersection(ray, plane)`、`closest_point(...)` 等
*   算法过程与演示节奏分离：`process` 定义过程，`timeline` 定义展示/讲解
*   所有可视化来自 gizmo/overlay 组合

7.2 DSL v0 结构（建议）
-----------------

*   `meta`: title/tags/level/order
*   `entities`: node/point/vector/ray/plane/camera/field/…
*   `relations`: distance/angle/projection/intersection/dependency/…
*   `process`: bfs / gradient\_descent / ray\_intersection / ray\_marching / dag\_schedule …
*   `views`: 3d/graph/inspector/plot + overlays 开关
*   `ui`: sliders/toggles/buttons（参数控制）
*   `timeline`: tracks + markers + clips
*   `seed`: 可选（保证确定性）

7.3 Validator（面向 AI 的报错）
------------------------

典型报错形式：

*   “process=bfs 需要 graph 类型 entities”
*   “intersection(ray, plane) 缺少 plane 引用”
*   “timeline.StepTrack 需要绑定到 process.steps”
*   “epsilon 必须 > 0”

7.4 Patch（AI 增量修改）
------------------

支持 AI 输出：

*   新增 marker
*   修改某轨道关键帧
*   插入 clip
*   改参数默认值  
    而不是重写整个 lesson

* * *

8\. Process 模型（让“过程类知识”统一）
==========================

> Process 是“产生状态序列”的机器：步骤、状态、失败原因、可回放。

每个 process 必须输出：

*   steps（可选）：`step[k]` 状态（位置/集合/路径/参数值…）
*   state：running / hit / miss / fail\_xxx …
*   metrics：可观测量（frontier size、loss、iteration…）
*   replay 支持：
    *   小规模：每步快照
    *   大规模：重算到 k + 关键帧快照（混合）

* * *

9\. Lesson 模板体系（覆盖全领域的关键）
=========================

你不应该“为每学科写新系统”，而是做模板：

1.  **Geometry Template（3D）**  
    点/向量/投影/相交/测量 + timeline markers
2.  **Graph Algorithm Template（Graph 2D + Step）**  
    BFS/DFS/Dijkstra/A\*：visited/frontier/path + step track
3.  **Numeric Iteration Template（Field + Trajectory）**  
    梯度下降/牛顿法：参数点移动 + loss 曲线（Plot 后置可先 Inspector）
4.  **Physics Process Template（VectorField + Trajectory）**  
    受力/积分：轨迹 + 能量/速度曲线
5.  **System DAG Template（Graph + Timeline Clips）**  
    RenderGraph/任务调度：依赖边 + 执行片段 + 资源读写（后置）

* * *

10\. 里程碑计划（从 0 到可用）
===================

Milestone A：平台壳 + 多视图 Host（先通用）
-------------------------------

交付：

*   Shell：左目录 / 中央视窗区 / 右 Inspector+Doc / 底部 Timeline Editor 区
*   ViewHost：可挂 3D + Graph + Inspector（Plot 可先占位）
*   Selection 联动：选中实体 → 高亮 + 属性面板显示

验收：

*   一个最小 demo：Node/Edge 图 + 3D 点 同时存在，点击联动

* * *

Milestone B：积木 v0（跨领域最小集合）
--------------------------

交付：

*   Node/Edge/Label/Marker/Badge
*   Point/Line/Arrow + MeasureDistance/Angle + ProjectionHelper
*   StepSequence + TraceTrail + StateOverlay
*   OverlayStack（开关/叠加/透明度）

验收：

*   用同一套积木做出 2 个 demo：
    1.  点积投影（几何）
    2.  BFS（图算法）

* * *

Milestone C：Timeline Runtime + Editor v0（编辑器式）
----------------------------------------------

交付：

*   TimelineRuntime（play/seek/speed/loop + stepped）
*   4 种 track runtime（property/event/step/state）
*   Timeline Editor：轨道、keyframes、markers（clips 可先简化为区间）
*   保存回 DSL（或保存 patch）

验收：

*   BFS 可逐步播放/回退/跳转 step
*   marker 跟随时间显示解释文本

* * *

Milestone D：DSL v0 + Compiler + Validator + Patch（AI 准入）
--------------------------------------------------------

交付：

*   schema + 示例库（dsl/examples）
*   validator（可读错误）
*   compiler（DSL → semantic graph → bindings/views/timeline）
*   patch（增量修改）

验收：

*   新 lesson：只新增一个 DSL 文件即可运行
*   DSL 写错：报语义错误不中断
*   patch 可新增 marker/改 keyframe

* * *

Milestone E：Field + Plot（解锁数值/ML/物理）
------------------------------------

交付：

*   ScalarField + SampleProbe
*   IsoLine（2D 等值线）/ 或简化 heatmap
*   PlotView（loss 曲线）或 Inspector 表格版（先低成本）

验收：

*   梯度下降：参数点移动 + loss 下降曲线

* * *

11\. 第一批“跨领域示例课程集”（建议直接作为验收集）
=============================

1.  几何：点积投影（vector projection + angle + measure）
2.  图算法：BFS（frontier/visited step-by-step）
3.  数值：梯度下降（loss field + trajectory + loss curve）
4.  系统：DAG 调度（任务依赖 + timeline clips）
5.  图形学：Ray–Plane/Ray–Triangle 最近命中（t 与交点 + state）

> 这 5 个跑通，你的平台就从“图形学 demo”跃迁为“通用可视化平台”。

* * *

12\. 工程规范（防止后期崩盘）
=================

*   Lesson 只允许 DSL，不允许直接写 three 逻辑
*   Gizmo/Overlay 必须 dispose（几何/材质/事件监听都释放）
*   所有对象都有稳定 ID，Selection 与 Binding 依赖 ID
*   语义锚点统一解析：camera/center/intersection/closest\_point…
*   Timeline 只改“展示”，Process 只管“过程”
*   每新增一个示例，先问：缺积木还是缺模板？优先补积木/模板

* * *

13\. 你现在可以立刻开始的“第一周任务单”（直接开干）
=============================

1.  搭 Vite+TS 项目骨架 + Shell 布局（含 Timeline 区域占位）
2.  实现 ViewHost：3D View + Graph View（哪怕 Graph 先画几个节点）
3.  实现 SemanticEntity/SelectionStore（选中联动）
4.  做 Gizmo v0：Point/Arrow/Label + MeasureAngle
5.  做 StepSequence（能显示 step 点串）
6.  做 TimelineRuntime（play/pause/step next/prev）
7.  做 Timeline Editor 最小版：markers 列表 + 时间条（后续再轨道化）
8.  第一个示例：点积投影（Geometry Template）

* * *

如果你希望我把这份“完整方案”进一步变成**仓库级的开发蓝图**，我可以在下一条消息直接给你：

*   核心 TypeScript 接口清单（Entities/Relations/Process/Track/Binding/View）
*   DSL v0 的 schema 草案（含 timeline/patch）
*   5 个示例课程的 DSL 初稿（可直接放进 `dsl/examples/`）

你无需再回答任何问题，我会按“最稳默认方案”给出可直接落地的版本。



---
Powered by [ChatGPT Exporter](https://www.chatgptexporter.com)